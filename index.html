<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0ea5e9" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="stylesheet" href="styles.css" />
  <title>Agenda PWA</title>

<script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
<script>
  window.OneSignalDeferred = window.OneSignalDeferred || [];
  OneSignalDeferred.push(async function(OneSignal) {
    await OneSignal.init({
      appId: "8e63d294-5e9d-4c27-ad35-5fee39e40091",
    });
  });
</script>

</head>
<body>
  <main>
    <header>
      <h1>Agenda</h1>
      <button id="installBtn" hidden>Install</button>
      <button id="enablePush">Aktifkan Notifikasi</button>
      <button id="enableDaily">Ingatkan harian</button>
    </header>

    <form id="f">
      <input id="title" placeholder="Judul agenda" required />
      <input id="start" type="datetime-local" required />
      <button>Simpan</button>
    </form>

    <ul id="list"></ul>
  </main>

  <script type="module" src="app.js"></script>
  <script>
    // PWA install prompt
    let deferredPrompt;
    const btn = document.getElementById('installBtn');
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault(); deferredPrompt = e; btn.hidden = false;
    });
    btn?.addEventListener('click', async () => {
      btn.hidden = true; await deferredPrompt.prompt(); deferredPrompt = null;
    });

    // Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js'));
    }
  </script>

  <!-- OneSignal SDK (web push) -->
  <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" async=""></script>
  <script>
    window.OneSignalDeferred = window.OneSignalDeferred || [];
    OneSignalDeferred.push(async function(OneSignal) {
      await OneSignal.init({
        appId: "8e63d294-5e9d-4c27-ad35-5fee39e40091",
        safari_web_id: "GANTI_DENGAN_SAFARI_WEB_ID" // untuk iOS/Mac Safari
      });
      document.getElementById('enablePush').addEventListener('click', () => {
        OneSignal.Notifications.requestPermission();
      });
    });
  </script>
  
<script>
  OneSignalDeferred.push(async function(OneSignal) {
    document.getElementById('enableDaily').onclick = async () => {
      // pastikan permission sudah diizinkan:
      await OneSignal.Notifications.requestPermission();
      // set tag agar bisa disegmentasi
      await OneSignal.User.addTag('daily', 'true');        // ikut daily
      await OneSignal.User.addTag('reminderTime', '07:00'); // opsional: jam favorit
      alert('Pengingat harian diaktifkan âœ…');
    };
  });
</script>

  
</body>
</html>


